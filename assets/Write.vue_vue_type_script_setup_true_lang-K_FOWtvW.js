var s=(w,v,n)=>new Promise((c,f)=>{var y=a=>{try{p(n.next(a))}catch(r){f(r)}},m=a=>{try{p(n.throw(a))}catch(r){f(r)}},p=a=>a.done?c(a.value):Promise.resolve(a.value).then(y,m);p((n=n.apply(w,v)).next())});import{F as x}from"./Form-6CSNlcUY.js";import{u as D}from"./useForm-qScLqIVZ.js";import{u as L}from"./useValidator-7yfg1EhU.js";import{i as R,c as T}from"./index-i99jxE2p.js";import{g as F}from"./index-x_RfLF-P.js";/* empty css               */import{_ as N}from"./AddButtonPermission.vue_vue_type_script_setup_true_lang-ka2DckFO.js";import{y as B,c as E}from"./element-plus--p0OFoYR.js";import{l as M,a as g,J as P,u as b,O as d,V as O,P as S,b as A,m as $,p as j}from"./vue-chunks-zxmGq976.js";const Y=M({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(w,{expose:v}){const{t:n}=T(),{required:c}=L(),f=w,y=o=>s(this,null,function*(){var t;const e=yield u();l({permissionList:(t=e==null?void 0:e.permissionList)==null?void 0:t.filter(k=>k.value!==o.value)})}),m=g(!1),p=P([{field:"type",label:"菜单类型",component:"RadioButton",value:0,colProps:{span:24},componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1}],on:{change:o=>s(this,null,function*(){const e=yield u();o===1?(i([{field:"component",path:"componentProps.disabled",value:!1}]),l({component:b(h)})):(i([{field:"component",path:"componentProps.disabled",value:!0}]),e.parentId===void 0?l({component:"#"}):l({component:"##"}))})}}},{field:"parentId",label:"父级菜单",component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"title",value:"id",children:"children"},highlightCurrent:!0,expandOnClickNode:!1,checkStrictly:!0,checkOnClickNode:!0,clearable:!0,on:{change:o=>s(this,null,function*(){var t;const e=yield u();o&&e.type===0?l({component:"##"}):!o&&e.type===0?l({component:"#"}):e.type===1&&l({component:(t=b(h))!=null?t:""})})}},optionApi:()=>s(this,null,function*(){return(yield F()).data.list||[]})},{field:"meta.title",label:n("menu.menuName"),component:"Input"},{field:"component",label:"组件",component:"Input",value:"#",componentProps:{disabled:!0,placeholder:"#为顶级目录，##为子目录",on:{change:o=>{h.value=o}}}},{field:"name",label:n("menu.name"),component:"Input"},{field:"meta.icon",label:n("menu.icon"),component:"Input"},{field:"path",label:n("menu.path"),component:"Input"},{field:"meta.activeMenu",label:n("menu.activeMenu"),component:"Input"},{field:"status",label:n("menu.status"),component:"Select",componentProps:{options:[{label:n("userDemo.disable"),value:0},{label:n("userDemo.enable"),value:1}]}},{field:"permissionList",label:n("menu.permission"),component:"CheckboxGroup",colProps:{span:24},formItemProps:{slots:{default:o=>{var e;return d(S,null,[(e=o==null?void 0:o.permissionList)==null?void 0:e.map(t=>d(B,{class:"mr-1",key:t.value,closable:!0,onClose:()=>y(t)},{default:()=>[t.label]})),d(R,{type:"primary",size:"small",onClick:()=>m.value=!0},{default:()=>[O("添加权限")]})])}}}},{field:"meta.hidden",label:n("menu.hidden"),component:"Switch"},{field:"meta.alwaysShow",label:n("menu.alwaysShow"),component:"Switch"},{field:"meta.noCache",label:n("menu.noCache"),component:"Switch"},{field:"meta.breadcrumb",label:n("menu.breadcrumb"),component:"Switch"},{field:"meta.affix",label:n("menu.affix"),component:"Switch"},{field:"meta.noTagsView",label:n("menu.noTagsView"),component:"Switch"},{field:"meta.canTo",label:n("menu.canTo"),component:"Switch"}]),a=P({component:[c()],path:[c()],"meta.title":[c()]}),{formRegister:r,formMethods:C}=D(),{setValues:l,getFormData:u,getElFormExpose:I,setSchema:i}=C,V=()=>s(this,null,function*(){const o=yield I();if(yield o==null?void 0:o.validate().catch(t=>{}))return yield u()}),h=g("");A(()=>f.currentRow,o=>{if(!o)return;const e=E(o);h.value=e.type===1?e.component:"",e.parentId===0?i([{field:"component",path:"componentProps.disabled",value:!0}]):i([{field:"component",path:"componentProps.disabled",value:!1}]),e.type===1?i([{field:"component",path:"componentProps.disabled",value:!1}]):i([{field:"component",path:"componentProps.disabled",value:!0}]),l(e)},{deep:!0,immediate:!0}),v({submit:V});const _=o=>s(this,null,function*(){const e=yield u();l({permissionList:[...(e==null?void 0:e.permissionList)||[],o]})});return(o,e)=>($(),j(S,null,[d(b(x),{rules:a,onRegister:b(r),schema:p},null,8,["rules","onRegister","schema"]),d(N,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),onConfirm:_},null,8,["modelValue"])],64))}});export{Y as _};
